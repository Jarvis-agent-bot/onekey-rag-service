# OneKey AI 智能分析平台：从交易解析到 DeFi 洞察

> 让每一笔交易都能看懂，让每一个决策都有依据。

---

## 一、项目概述

### 1.1 背景与愿景

Web3 正在经历从「可用」到「可读」的关键转型。每天有数百万笔链上交易发生，但普通用户面对一串哈希和十六进制数据时，往往一头雾水：

- **这笔交易做了什么？** Swap？质押？授权？
- **我的资产安全吗？** 是否有异常授权？是否与高风险合约交互？
- **这个协议值得参与吗？** TVL 趋势如何？收益率是否可持续？

**OneKey AI 智能分析平台**致力于成为 Web3 世界的「翻译官」和「分析师」，让链上数据从「机器可读」变成「人人可懂」。

### 1.2 产品矩阵

| 产品 | 定位 | 核心价值 |
|------|------|----------|
| **交易解析引擎** | 单笔交易的「X 光机」 | 告诉用户「这笔交易做了什么」 |
| **DeFi 智能洞察** | 市场的「AI 分析师」 | 告诉用户「现在应该关注什么」 |

两个产品共享同一套 AI 基础设施，形成数据飞轮：交易解析积累协议知识 → 反哺市场分析的准确性。

---

## 二、产品一：交易解析引擎

### 2.1 解决的问题

当用户在 OneKey 钱包中查看一笔交易时，看到的往往是：

```
To: 0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D
Input Data: 0x38ed1739000000000000000000000000...
```

**用户的困惑**：
- 这是什么合约？（Uniswap V2 Router）
- 调用了什么方法？（swapExactTokensForTokens）
- 具体发生了什么？（用 100 USDC 换了 0.05 ETH）

### 2.2 产品能力

**输入**：`tx_hash` / `address` / `block`

**输出**：结构化解析结果 + 自然语言解释

```json
{
  "behavior": {
    "type": "swap",
    "confidence": "high",
    "summary": "在 Uniswap V2 上用 100 USDC 兑换了约 0.05 ETH"
  },
  "events": [
    {"name": "Transfer", "from": "0x用户", "to": "0xPair", "value": "100 USDC"},
    {"name": "Swap", "amount0In": "100000000", "amount1Out": "50000000000000000"}
  ],
  "risk_flags": [],
  "sources": {
    "abi": "https://api.etherscan.io/...",
    "protocol_docs": "https://docs.uniswap.org/..."
  }
}
```

### 2.3 技术架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        交易解析引擎                              │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │  链上数据层  │ →  │  结构化解析  │ →  │  RAG 解释层  │         │
│  │ JSON-RPC    │    │ ABI 解码    │    │ 知识库检索   │         │
│  │ Etherscan   │    │ 事件归类    │    │ LLM 生成    │         │
│  │ Trace 模拟  │    │ 行为识别    │    │ 证据引用    │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
├─────────────────────────────────────────────────────────────────┤
│                    知识库（协议文档）                            │
│  Uniswap · Aave · Lido · OpenSea · 1inch · GMX · ...           │
└─────────────────────────────────────────────────────────────────┘
```

### 2.4 核心优势

| 能力 | 说明 |
|------|------|
| **多链支持** | Ethereum / BSC / Polygon / Arbitrum 等 EVM 兼容链 |
| **置信度分层** | 高/中/低三级置信度，低置信度不做强归因 |
| **证据可追溯** | 每个结论都有明确的证据来源（事件/方法/文档） |
| **风险识别** | 自动检测无限授权、可疑合约等风险模式 |
| **持续更新** | 知识库每周同步最新协议文档 |

### 2.5 应用场景

- **钱包交易详情**：OneKey App/Extension 内嵌解析
- **区块链浏览器**：增强版交易页面
- **安全审计**：批量分析可疑地址的交易历史
- **合规报告**：为机构用户生成交易说明

---

## 三、产品二：DeFi 智能洞察

### 3.1 解决的问题

DeFi 用户每天面临信息过载：

- 几十个协议的 TVL 变化
- 各种代币的价格波动
- 社交媒体上的真假消息
- 治理提案和协议升级

**用户需要的不是更多数据，而是有价值的洞察。**

### 3.2 产品能力

类似老虎证券的「AI 研报」，专注于 DeFi 领域：

| 功能模块 | 说明 |
|----------|------|
| **协议仪表盘** | TVL、APY、利用率等核心指标追踪 |
| **新闻聚合** | 自动抓取并分析 Twitter/Discord/治理论坛 |
| **情感分析** | 量化市场情绪，识别 FUD/FOMO |
| **风险预警** | 大额转账、异常流动性变化、安全事件 |
| **AI 研报** | 基于 RAG 生成协议分析报告 |

### 3.3 数据架构

```
┌─────────────────────────────────────────────────────────────────┐
│                      DeFi 智能洞察                              │
├─────────────────────────────────────────────────────────────────┤
│                        数据采集层                               │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │
│  │ 链上数据  │ │ 市场数据  │ │ 新闻媒体  │ │ 社交信号  │          │
│  │DefiLlama │ │CoinGecko │ │  RSS/API │ │ Twitter  │          │
│  │  Dune    │ │   CMC    │ │  公告    │ │ Discord  │          │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘          │
├─────────────────────────────────────────────────────────────────┤
│                        分析引擎                                 │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │
│  │ 指标计算  │ │ 情感分析  │ │ 风险评分  │ │ RAG 生成  │          │
│  │ 趋势识别  │ │ NLP 分类  │ │ 多因子模型│ │ 研报撰写  │          │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘          │
├─────────────────────────────────────────────────────────────────┤
│                        输出层                                   │
│  仪表盘 · 推送通知 · AI 问答 · 研报导出                          │
└─────────────────────────────────────────────────────────────────┘
```

### 3.4 示例输出

**协议快照**：

```json
{
  "protocol": "Aave V3",
  "chain": "Ethereum",
  "snapshot_time": "2025-01-13T10:00:00Z",
  "metrics": {
    "tvl": "$12.5B",
    "tvl_change_7d": "+3.2%",
    "top_pools": [
      {"asset": "USDC", "apy": "4.2%", "utilization": "82%"},
      {"asset": "ETH", "apy": "2.1%", "utilization": "65%"}
    ]
  },
  "sentiment": {
    "score": 0.72,
    "trend": "positive",
    "key_signals": [
      "GHO 稳定币采用率上升",
      "V4 升级提案通过社区投票"
    ]
  },
  "risk_assessment": {
    "level": "low",
    "factors": [
      {"name": "智能合约风险", "score": "A", "note": "多次审计，无重大漏洞"},
      {"name": "流动性风险", "score": "A", "note": "TVL 充足，利用率健康"},
      {"name": "治理风险", "score": "B+", "note": "代币分布较集中"}
    ]
  },
  "ai_summary": "Aave V3 本周表现稳健，TVL 持续增长。USDC 池利用率较高（82%），借款需求旺盛。社区对 V4 升级持积极态度，预计将在 Q2 上线。建议关注 GHO 稳定币的 peg 稳定性。"
}
```

### 3.5 应用场景

- **个人投资者**：每日 DeFi 市场简报
- **机构用户**：协议尽调报告
- **项目方**：竞品监控和市场情绪追踪
- **媒体**：自动化行业数据支持

---

## 四、技术底座：OneKey RAG Service

两个产品共享同一套 AI 基础设施：

### 4.1 已建成能力

| 模块 | 技术选型 | 状态 |
|------|----------|------|
| 向量数据库 | pgvector | ✅ 生产就绪 |
| 检索策略 | Hybrid Search (向量+BM25) | ✅ 生产就绪 |
| 重排序 | BGE-Reranker | ✅ 生产就绪 |
| 多轮对话 | Query Rewrite + Memory Summary | ✅ 生产就绪 |
| 引用系统 | Inline Citations `[1][2]` | ✅ 生产就绪 |
| 可观测性 | Langfuse 全链路 Trace | ✅ 生产就绪 |
| API 兼容 | OpenAI `/v1/chat/completions` | ✅ 生产就绪 |
| 管理后台 | Admin UI + JWT 鉴权 | ✅ 生产就绪 |

### 4.2 架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                     OneKey RAG Service                          │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                      API Layer                           │   │
│  │  /v1/chat/completions (OpenAI Compatible)               │   │
│  │  /admin/api/* (管理接口)                                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                     RAG Pipeline                         │   │
│  │  Query Rewrite → Embedding → Hybrid Search → Rerank     │   │
│  │       → Context Build → LLM Generate → Citation         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │   pgvector   │  │  Embeddings  │  │   Reranker   │         │
│  │  向量存储    │  │ Multilingual │  │ BGE-Reranker │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│                              ↓                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Knowledge Base                        │   │
│  │  协议文档 · ABI 仓库 · 行为模板 · 风险案例               │   │
│  └─────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────┤
│  Observability: Langfuse Trace · Metrics · Feedback Loop       │
└─────────────────────────────────────────────────────────────────┘
```

### 4.3 技术栈

| 层级 | 技术选型 |
|------|----------|
| **Web 框架** | FastAPI |
| **向量数据库** | PostgreSQL + pgvector |
| **Embedding** | sentence-transformers (多语言) |
| **重排序** | BGE-Reranker (cross-encoder) |
| **LLM 接入** | OpenAI Compatible API |
| **可观测性** | Langfuse |
| **任务队列** | 内置 Worker + Jobs 表 |
| **部署** | Docker Compose |

---

## 五、商业价值

### 5.1 市场机会

| 市场 | 规模 | 痛点 |
|------|------|------|
| **钱包用户** | 全球 5000 万+ | 看不懂交易、担心安全 |
| **DeFi 投资者** | 活跃用户 500 万+ | 信息过载、决策困难 |
| **机构/合规** | 快速增长 | 审计报告、尽调需求 |

### 5.2 竞争优势

| 对比维度 | 传统方案 | OneKey AI |
|----------|----------|-----------|
| 交易解释 | 仅显示原始数据 | 自然语言 + 结构化 |
| 数据来源 | 单一链浏览器 | 多源聚合 + 知识库 |
| 分析深度 | 数值展示 | AI 洞察 + 风险评估 |
| 用户体验 | 开发者友好 | 普通用户友好 |

### 5.3 变现路径

| 阶段 | 模式 | 说明 |
|------|------|------|
| **Phase 1** | 产品增值 | 提升 OneKey 钱包核心竞争力 |
| **Phase 2** | API 服务 | 向第三方钱包/浏览器提供 API |
| **Phase 3** | 订阅制 | Pro 版高级分析功能 |

---

## 六、路线图

```
2025 Q1                    2025 Q2                    2025 Q3
   │                          │                          │
   ▼                          ▼                          ▼
┌──────────┐            ┌──────────┐            ┌──────────┐
│ RAG 基础  │     →      │ 交易解析  │     →      │ DeFi 洞察 │
│ 设施完善  │            │   MVP    │            │   MVP    │
├──────────┤            ├──────────┤            ├──────────┤
│• 知识库   │            │• ABI 解码 │            │• 数据聚合 │
│  扩充     │            │• 行为识别 │            │• 情感分析 │
│• 多语言   │            │• 风险标签 │            │• 风险评分 │
│• 性能优化 │            │• 钱包集成 │            │• 推送系统 │
└──────────┘            └──────────┘            └──────────┘
     ✅                      🔄                      📋
   已完成                   进行中                   规划中
```

---

## 七、团队优势

- **基础设施就绪**：RAG Service 已完成核心建设，可直接复用
- **领域知识积累**：OneKey 在硬件钱包和 Web3 安全领域的深厚积累
- **用户触达能力**：OneKey 钱包的存量用户基础
- **技术迭代速度**：灵活的技术栈，快速响应市场需求

---

## 八、风险与应对

| 风险类型 | 描述 | 应对策略 |
|----------|------|----------|
| **AI 准确性** | LLM 可能产生幻觉 | 置信度分层 + 证据引用 + 人工审核机制 |
| **数据时效性** | 协议升级导致解析失效 | 知识库定期更新 + 版本管理 |
| **合规风险** | 投资建议可能触发监管 | 明确免责声明 + 仅提供信息不做推荐 |
| **竞争压力** | 大厂可能入场 | 深耕垂直领域 + 与钱包深度整合 |

---

## 九、总结

**OneKey AI 智能分析平台**通过「交易解析」和「DeFi 洞察」两个产品，构建 Web3 世界的智能信息层：

> **让每一笔交易都能看懂，让每一个决策都有依据。**

这不仅是产品能力的提升，更是 OneKey 从「工具提供商」向「智能服务平台」升级的关键一步。

---

## 附录：相关文档

- [RAG Service 技术规格](./onekey-rag-service-spec.md)
- [Web3 交易解析基线方案](./rag-web3-trade-analysis.md)
- [前端接入规格](./onekey-rag-frontend-spec.md)

---

*文档版本：v1.0*
*更新日期：2025-01-13*
*维护团队：OneKey AI Team*
