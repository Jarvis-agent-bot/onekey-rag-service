# Web3 Transaction Analyzer å®Œæ•´æŒ‡å—

> ç»¼åˆåç«¯å®ç°è§„åˆ’ã€å‰ç«¯è®¾è®¡ã€æµè§ˆå™¨æ‰©å±•æ–¹æ¡ˆä¸çŸ¥è¯†åº“å»ºè®¾

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
3. [åç«¯æœåŠ¡è®¾è®¡](#3-åç«¯æœåŠ¡è®¾è®¡)
4. [å‰ç«¯ç•Œé¢è®¾è®¡](#4-å‰ç«¯ç•Œé¢è®¾è®¡)
5. [æµè§ˆå™¨æ‰©å±•æ–¹æ¡ˆ](#5-æµè§ˆå™¨æ‰©å±•æ–¹æ¡ˆ)
6. [API è§„èŒƒ](#6-api-è§„èŒƒ)
7. [å‡½æ•°ç­¾åæŸ¥è¯¢æœºåˆ¶](#7-å‡½æ•°ç­¾åæŸ¥è¯¢æœºåˆ¶)
8. [éƒ¨ç½²é…ç½®](#8-éƒ¨ç½²é…ç½®)
9. [çŸ¥è¯†åº“å»ºè®¾](#9-çŸ¥è¯†åº“å»ºè®¾)
10. [å®æ–½è¿›åº¦](#10-å®æ–½è¿›åº¦)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 æ ¸å¿ƒå®šä½

**Web3 Transaction Analyzer** æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é“¾ä¸Šäº¤æ˜“åˆ†æå¾®æœåŠ¡ï¼Œæä¾›ï¼š

| èƒ½åŠ› | è¯´æ˜ |
|------|------|
| æ™ºèƒ½åˆ†æ | è‡ªåŠ¨è¯†åˆ«è¾“å…¥ç±»å‹ï¼ˆäº¤æ˜“å“ˆå¸Œ/Calldata/ç­¾åï¼‰ |
| äº¤æ˜“è§£æ | è§£ç æ–¹æ³•è°ƒç”¨ã€äº‹ä»¶æ—¥å¿— |
| Calldata è§£ç  | è§£ææœªç­¾åäº¤æ˜“çš„ calldata æ•°æ® |
| ç­¾åè§£æ | è§£æ EIP-712 ç­¾åã€Permit ç­‰ç­¾åè¯·æ±‚ |
| è¡Œä¸ºè¯†åˆ« | è¯†åˆ« Swap/Transfer/Approve ç­‰è¡Œä¸º |
| é£é™©æ£€æµ‹ | æ£€æµ‹æ— é™æˆæƒã€å¤§é¢è½¬è´¦ç­‰é£é™© |
| RAG è§£é‡Š | è°ƒç”¨ RAG ç”Ÿæˆè‡ªç„¶è¯­è¨€è§£é‡Šï¼ˆæ”¯æŒæ‰€æœ‰è¾“å…¥ç±»å‹ï¼‰ |

### 1.2 ä½¿ç”¨åœºæ™¯

```
åœºæ™¯ 1ï¼šé’±åŒ… App äº¤æ˜“è§£è¯»
  ç”¨æˆ·æŸ¥çœ‹äº¤æ˜“è¯¦æƒ… â†’ POST /v1/smart-analyze â†’ å±•ç¤ºè§£é‡Š + é£é™©æç¤º

åœºæ™¯ 2ï¼šäº¤æ˜“ç­¾åé¢„æ‰§è¡Œï¼ˆæ ¸å¿ƒåœºæ™¯ï¼‰
  ç”¨æˆ·ç­¾åå‰ â†’ POST /v1/smart-analyze (calldata) â†’ é¢„è§ˆè¡Œä¸ºä¸é£é™©

åœºæ™¯ 3ï¼šEIP-712 ç­¾åå®‰å…¨æ£€æŸ¥
  ç”¨æˆ·ç­¾åè¯·æ±‚ â†’ POST /v1/smart-analyze (signature) â†’ è§£ææˆæƒå†…å®¹

åœºæ™¯ 4ï¼šå¼€å‘è€… Debug
  å¼€å‘è€…è¾“å…¥ tx_hash â†’ include_trace=true â†’ è·å–å®Œæ•´ trace æ—¥å¿—

åœºæ™¯ 5ï¼šåŒºå—æµè§ˆå™¨å¢å¼º
  æµè§ˆå™¨æ‰©å±• â†’ è‡ªåŠ¨è§£æå½“å‰é¡µé¢äº¤æ˜“ â†’ æ˜¾ç¤º AI åˆ†æ
```

### 1.3 è¾“å…¥ç±»å‹è‡ªåŠ¨è¯†åˆ«

Smart Analyze API æ”¯æŒä¸‰ç§è¾“å…¥ç±»å‹çš„è‡ªåŠ¨è¯†åˆ«ï¼š

| è¾“å…¥ç±»å‹ | æ ¼å¼ | è¯†åˆ«è§„åˆ™ | ç¤ºä¾‹ |
|----------|------|----------|------|
| `tx_hash` | 0x + 64å­—ç¬¦ | åå…­è¿›åˆ¶ï¼Œé•¿åº¦=64 | `0xabc...def` (64å­—ç¬¦) |
| `calldata` | 0x + â‰¥8å­—ç¬¦ | åå…­è¿›åˆ¶ï¼Œé•¿åº¦â‰¥8 | `0xa9059cbb000...` |
| `signature` | JSON å¯¹è±¡ | åŒ…å« domain + message | `{"domain":{...},"message":{...}}` |

### 1.4 æŠ€æœ¯æ ˆ

**åç«¯**ï¼š

| ç»„ä»¶ | é€‰å‹ | ç†ç”± |
|------|------|------|
| Web æ¡†æ¶ | FastAPI | å¼‚æ­¥æ”¯æŒï¼ŒOpenAPI æ–‡æ¡£ |
| HTTP å®¢æˆ·ç«¯ | httpx | å¼‚æ­¥æ”¯æŒ |
| ABI è§£ç  | eth-abi | æ ‡å‡†ä»¥å¤ªåŠ ABI ç¼–è§£ç  |
| æ—¥å¿— | structlog | ç»“æ„åŒ– JSON æ—¥å¿— |
| ORM | SQLAlchemy | æ•°æ®åº“æ“ä½œ |
| ç¼“å­˜ | Redis | é«˜æ€§èƒ½ç¼“å­˜ |

**å‰ç«¯**ï¼š

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| React | 18.x | UI æ¡†æ¶ |
| TypeScript | 5.x | ç±»å‹å®‰å…¨ |
| Vite | 5.x | æ„å»ºå·¥å…· |
| TailwindCSS | 3.x | æ ·å¼æ¡†æ¶ |
| shadcn/ui | - | UI ç»„ä»¶åº“ |

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ¶æ„å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              Docker Compose ç¼–æ’                 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                â”‚                                â”‚
         â–¼                                â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ web3-tx-analyzerâ”‚            â”‚onekey-rag-serviceâ”‚           â”‚   PostgreSQL    â”‚
â”‚    :8001        â”‚â”€â”€â”€HTTPâ”€â”€â”€â”€â–¶â”‚    :8000        â”‚            â”‚    :5432        â”‚
â”‚                 â”‚            â”‚                 â”‚            â”‚                 â”‚
â”‚ â€¢ äº¤æ˜“è§£æ      â”‚            â”‚ â€¢ RAG æ£€ç´¢      â”‚            â”‚ â€¢ tx_analyzer   â”‚
â”‚ â€¢ Calldataè§£ç   â”‚            â”‚ â€¢ è¯­ä¹‰ç”Ÿæˆ      â”‚            â”‚   schema        â”‚
â”‚ â€¢ ç­¾åè§£æ      â”‚            â”‚ â€¢ çŸ¥è¯†åº“        â”‚            â”‚ â€¢ rag schema    â”‚
â”‚ â€¢ è¡Œä¸ºè¯†åˆ«      â”‚            â”‚                 â”‚            â”‚                 â”‚
â”‚ â€¢ é£é™©æ£€æµ‹      â”‚            â”‚                 â”‚            â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                                             â”‚
         â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚     Redis       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚    :6379        â”‚
                               â”‚ â€¢ ABI ç¼“å­˜      â”‚
                               â”‚ â€¢ è§£æç»“æœç¼“å­˜  â”‚
                               â”‚ â€¢ ç­¾åç¼“å­˜      â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                              â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EVM Chains     â”‚            â”‚   Etherscan     â”‚            â”‚  4byte.directoryâ”‚
â”‚  (JSON-RPC)     â”‚            â”‚   API           â”‚            â”‚  (ç­¾åæ•°æ®åº“)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç›®å½•ç»“æ„

```
onekey-rag-service/
â”œâ”€â”€ onekey_rag_service/              # ç°æœ‰ RAG æœåŠ¡
â”œâ”€â”€ services/                        # ç‹¬ç«‹æœåŠ¡ç›®å½•
â”‚   â””â”€â”€ web3-tx-analyzer/
â”‚       â”œâ”€â”€ main.py                  # FastAPI å…¥å£
â”‚       â”œâ”€â”€ config.py                # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ Dockerfile               # ç‹¬ç«‹é•œåƒ
â”‚       â”œâ”€â”€ api/                     # API å±‚
â”‚       â”‚   â”œâ”€â”€ routes.py            # è·¯ç”±å®šä¹‰ï¼ˆå« smart-analyzeï¼‰
â”‚       â”‚   â””â”€â”€ schemas.py           # è¯·æ±‚/å“åº”æ¨¡å‹
â”‚       â”œâ”€â”€ analyzer/                # æ ¸å¿ƒè§£æé€»è¾‘
â”‚       â”‚   â”œâ”€â”€ parser.py            # ä¸»è§£ææµç¨‹ + _get_abi()
â”‚       â”‚   â”œâ”€â”€ abi_decoder.py       # ABI è§£ç 
â”‚       â”‚   â”œâ”€â”€ calldata_decoder.py  # Calldata è§£ç å™¨ï¼ˆæ–°ï¼‰
â”‚       â”‚   â”œâ”€â”€ signature_parser.py  # EIP-712 ç­¾åè§£æå™¨ï¼ˆæ–°ï¼‰
â”‚       â”‚   â”œâ”€â”€ simulator.py         # äº¤æ˜“æ¨¡æ‹Ÿå™¨ï¼ˆæ–°ï¼‰
â”‚       â”‚   â”œâ”€â”€ event_classifier.py  # äº‹ä»¶åˆ†ç±»
â”‚       â”‚   â”œâ”€â”€ behavior_analyzer.py # è¡Œä¸ºè¯†åˆ«
â”‚       â”‚   â”œâ”€â”€ risk_detector.py     # é£é™©æ£€æµ‹
â”‚       â”‚   â””â”€â”€ schemas.py           # æ•°æ®æ¨¡å‹
â”‚       â”œâ”€â”€ integrations/            # å¤–éƒ¨æœåŠ¡é›†æˆ
â”‚       â”‚   â”œâ”€â”€ rpc_client.py        # EVM JSON-RPC
â”‚       â”‚   â”œâ”€â”€ etherscan_client.py  # é“¾æµè§ˆå™¨ API
â”‚       â”‚   â””â”€â”€ signature_db.py      # 4byte ç­¾ååº“ï¼ˆå«æœ¬åœ°ç¼“å­˜ï¼‰
â”‚       â”œâ”€â”€ clients/                 # å†…éƒ¨æœåŠ¡å®¢æˆ·ç«¯
â”‚       â”‚   â””â”€â”€ rag_client.py        # RAG æœåŠ¡å®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ storage/                 # æ•°æ®å­˜å‚¨
â”‚       â”‚   â”œâ”€â”€ models.py            # SQLAlchemy æ¨¡å‹
â”‚       â”‚   â”œâ”€â”€ db.py                # æ•°æ®åº“è¿æ¥
â”‚       â”‚   â””â”€â”€ cache.py             # Redis ç¼“å­˜
â”‚       â””â”€â”€ app_logging/             # æ—¥å¿—æ¨¡å—
â”‚           â”œâ”€â”€ logger.py            # ç»“æ„åŒ– JSON æ—¥å¿—
â”‚           â””â”€â”€ tracer.py            # è¯¦ç»† trace è¿½è¸ª
â”‚
â”œâ”€â”€ frontend-tx-analyzer/            # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ web/                     # Web åº”ç”¨å…¥å£
â”‚   â”‚   â”‚   â””â”€â”€ WebApp.tsx           # ä¸»ç•Œé¢ï¼ˆSmart Inputï¼‰
â”‚   â”‚   â”œâ”€â”€ shared/                  # å…±äº«æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ api/                 # API å®¢æˆ·ç«¯ + ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ components/          # UI ç»„ä»¶ (shadcn/ui)
â”‚   â”‚   â”‚   â”œâ”€â”€ features/            # åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ analyze/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ SmartInput.tsx       # æ™ºèƒ½è¾“å…¥ç»„ä»¶
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ CalldataResult.tsx   # Calldata ç»“æœå±•ç¤º
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ SignatureResult.tsx  # ç­¾åç»“æœå±•ç¤º
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ RagExplanation.tsx   # RAG è§£é‡Šå±•ç¤º
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ RiskAssessment.tsx   # é£é™©è¯„ä¼°
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â”‚   â””â”€â”€ lib/                 # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ popup/                   # æµè§ˆå™¨æ‰©å±• Popup
â”‚   â”‚   â”œâ”€â”€ sidepanel/               # æµè§ˆå™¨æ‰©å±•ä¾§è¾¹æ 
â”‚   â”‚   â””â”€â”€ content-scripts/         # å†…å®¹è„šæœ¬
â”‚   â””â”€â”€ vite.config.ts
â”‚
â””â”€â”€ docs/
    â””â”€â”€ web3-tx-analyzer-complete-guide.md
```

---

## 3. åç«¯æœåŠ¡è®¾è®¡

### 3.1 æ”¯æŒçš„é“¾

| Chain | Chain ID | RPC | Explorer |
|-------|----------|-----|----------|
| Ethereum | 1 | https://eth.llamarpc.com | Etherscan |
| BSC | 56 | https://bsc-dataseed.binance.org | BscScan |
| Polygon | 137 | https://polygon-rpc.com | PolygonScan |
| Arbitrum | 42161 | https://arb1.arbitrum.io/rpc | Arbiscan |
| Optimism | 10 | https://mainnet.optimism.io | Optimistic Etherscan |

### 3.2 è¡Œä¸ºç±»å‹

| è¡Œä¸º | è¯†åˆ«ä¾æ® |
|------|----------|
| `swap` | DEX Router è°ƒç”¨ + Swap äº‹ä»¶ |
| `bridge` | Bridge åˆçº¦ + Lock/Mint äº‹ä»¶ |
| `stake` | Staking åˆçº¦ + Stake/Deposit äº‹ä»¶ |
| `transfer` | ERC20/721 Transfer äº‹ä»¶ |
| `approve` | Approval äº‹ä»¶ / approve æ–¹æ³• |
| `mint` | Mint äº‹ä»¶ |
| `liquidity_add` | addLiquidity æ–¹æ³• |
| `liquidity_remove` | removeLiquidity æ–¹æ³• |
| `wrap` / `unwrap` | WETH deposit/withdraw |
| `signature_request` | EIP-712 ç­¾åè¯·æ±‚ |
| `unknown` | æ— æ³•è¯†åˆ« |

### 3.3 é£é™©æ£€æµ‹

| é£é™©ç±»å‹ | ä¸¥é‡ç¨‹åº¦ | è¯´æ˜ |
|----------|----------|------|
| `unlimited_approve` | High | æ— é™æˆæƒï¼ˆæ¥è¿‘ MAX_UINT256ï¼‰ |
| `nft_approval_for_all` | High | NFT setApprovalForAll(true) |
| `high_value_transfer` | Medium | å¤§é¢åŸç”Ÿä»£å¸è½¬è´¦ |
| `transfer_to_zero` | High | å‘é›¶åœ°å€è½¬è´¦ |
| `dangerous_function` | High | å±é™©å‡½æ•°è°ƒç”¨ï¼ˆPermit ç­‰ï¼‰ |
| `permit_signature` | High | EIP-2612 Permit ç­¾å |
| `permit2_signature` | High | Uniswap Permit2 ç­¾å |

### 3.4 æ ¸å¿ƒæ¨¡å—

#### 3.4.1 CalldataDecoderï¼ˆCalldata è§£ç å™¨ï¼‰

è§£ç æœªç­¾å/æœªå‘é€äº¤æ˜“çš„ calldata æ•°æ®ï¼š

```python
class CalldataDecoder:
    """Calldata è§£ç å™¨"""

    async def decode(
        self,
        calldata: str,           # åŸå§‹ calldata (0x å¼€å¤´)
        context: CalldataContext | None = None,  # ä¸Šä¸‹æ–‡ï¼ˆé“¾IDã€ç›®æ ‡åœ°å€ç­‰ï¼‰
        abi: list[dict] | None = None,           # å¯é€‰çš„åˆçº¦ ABI
    ) -> DecodedCalldata:
        """
        è§£ç æµç¨‹ï¼š
        1. å°è¯•ä» ABI è§£ç 
        2. å¦‚æœæ²¡æœ‰ ABIï¼ŒæŸ¥è¯¢ç­¾åæ•°æ®åº“ï¼ˆå…ˆæœ¬åœ°ï¼Œå 4byte.directoryï¼‰
        3. åˆ†æè¡Œä¸ºç±»å‹
        4. æ£€æµ‹é£é™©
        5. è¯†åˆ«åˆçº¦ç±»å‹
        """
```

#### 3.4.2 SignatureParserï¼ˆç­¾åè§£æå™¨ï¼‰

è§£æ EIP-712 ç­¾åè¯·æ±‚ï¼š

```python
class SignatureParser:
    """EIP-712 ç­¾åè§£æå™¨"""

    def parse(self, data: dict | str) -> SignatureAnalysis:
        """
        è§£ææµç¨‹ï¼š
        1. è§£æ JSON æ•°æ®
        2. è¯†åˆ«ç­¾åç±»å‹ï¼ˆPermitã€Permit2ã€NFT Permitã€Order ç­‰ï¼‰
        3. æå–å…³é”®ä¿¡æ¯ï¼ˆæˆæƒé‡‘é¢ã€spenderã€deadlineï¼‰
        4. è¯„ä¼°é£é™©ç­‰çº§
        """
```

æ”¯æŒçš„ç­¾åç±»å‹ï¼š
- ERC-2612 Permitï¼ˆToken æˆæƒï¼‰
- Uniswap Permit2ï¼ˆæ‰¹é‡æˆæƒï¼‰
- NFT Permitï¼ˆNFT æˆæƒï¼‰
- Seaport Orderï¼ˆNFT äº¤æ˜“è®¢å•ï¼‰
- Generic EIP-712ï¼ˆé€šç”¨ç­¾åï¼‰

### 3.5 æ•°æ®åº“è®¾è®¡

```sql
-- ä½¿ç”¨ç‹¬ç«‹ schema éš”ç¦»
CREATE SCHEMA IF NOT EXISTS tx_analyzer;

-- è§£æç»“æœç¼“å­˜è¡¨
CREATE TABLE tx_analyzer.parse_results (
    id SERIAL PRIMARY KEY,
    chain_id INTEGER NOT NULL,
    tx_hash VARCHAR(66) NOT NULL,
    block_number BIGINT,
    parse_result JSONB NOT NULL,
    behavior_type VARCHAR(32),
    confidence VARCHAR(16),
    parser_version VARCHAR(16) NOT NULL,
    parsed_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(chain_id, tx_hash)
);

-- ABI ç¼“å­˜è¡¨
CREATE TABLE tx_analyzer.abi_cache (
    id SERIAL PRIMARY KEY,
    chain_id INTEGER NOT NULL,
    contract_address VARCHAR(42) NOT NULL,
    abi JSONB,
    source VARCHAR(32),
    fetched_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(chain_id, contract_address)
);

-- è§£ææ—¥å¿—è¡¨
CREATE TABLE tx_analyzer.parse_logs (
    id SERIAL PRIMARY KEY,
    trace_id VARCHAR(64) NOT NULL,
    chain_id INTEGER NOT NULL,
    tx_hash VARCHAR(66) NOT NULL,
    status VARCHAR(16),
    behavior_type VARCHAR(32),
    total_ms INTEGER,
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

## 4. å‰ç«¯ç•Œé¢è®¾è®¡

### 4.1 Smart Input ç•Œé¢

å‰ç«¯ç°åœ¨ä½¿ç”¨ç»Ÿä¸€çš„æ™ºèƒ½è¾“å…¥ç•Œé¢ï¼Œè‡ªåŠ¨è¯†åˆ«è¾“å…¥ç±»å‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›¡ï¸ Web3 Transaction Analyzer                          [OneKey]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  è¾“å…¥äº¤æ˜“å“ˆå¸Œã€Calldata æˆ– EIP-712 ç­¾åæ•°æ®                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  0x69328dec000000000000000000000000a0b86991c6218b36c1...     â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  è¯†åˆ«ç±»å‹: [Calldata]        é“¾: [Ethereum â–¼]                      â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â–¼ é«˜çº§é€‰é¡¹                                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ ç›®æ ‡åœ°å€ (to): [0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D] â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ å‘é€è€… (from): [å¯é€‰]                                       â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ å‘é€é‡‘é¢ (value): [0]                                       â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â˜‘ åŒ…å« AI è§£é‡Š    â˜ åŒ…å« Trace                                   â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚                              [ğŸ” æ™ºèƒ½åˆ†æ]                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€ åˆ†æç»“æœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€ Calldata è§£ç  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ å‡½æ•°å: removeLiquidityETHWithPermit                        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ Selector: 0x69328dec                                        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ è¡Œä¸ºç±»å‹: liquidity_remove                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ é£é™©ç­‰çº§: ğŸŸ¢ Low                                            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                              â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ å‚æ•°:                                                        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   token: 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48 (USDC)  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   liquidity: 1000000000000000000                            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   amountTokenMin: 990000000                                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   ...                                                        â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€ AI åˆ†æ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ ğŸ“ è¿™æ˜¯ä¸€ç¬”ä» Uniswap V2 ç§»é™¤æµåŠ¨æ€§çš„äº¤æ˜“ã€‚ç”¨æˆ·æ­£åœ¨ç§»é™¤      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    USDC-ETH æµåŠ¨æ€§æ± ä¸­çš„ LP Tokenï¼Œå¹¶ä½¿ç”¨ Permit ç­¾åæˆæƒ    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    è€Œä¸æ˜¯ä¼ ç»Ÿçš„ approve äº¤æ˜“ï¼Œå¯ä»¥èŠ‚çœ gas è´¹ç”¨ã€‚            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                              â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ é£é™©æç¤º:                                                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ âœ“ æ“ä½œç›®æ ‡ä¸ºçŸ¥å DEX (Uniswap V2 Router)                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ âœ“ æ»‘ç‚¹ä¿æŠ¤å·²è®¾ç½®                                            â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ä¸‰ç§ç»“æœå±•ç¤º

æ ¹æ®è¾“å…¥ç±»å‹ï¼Œæ˜¾ç¤ºä¸åŒçš„ç»“æœç»„ä»¶ï¼š

| è¾“å…¥ç±»å‹ | ç»“æœç»„ä»¶ | æ˜¾ç¤ºå†…å®¹ |
|----------|----------|----------|
| `tx_hash` | ResultOverview + RiskAssessment + MethodDetail + EventList | å®Œæ•´äº¤æ˜“è§£æ |
| `calldata` | CalldataResult + RagExplanation | å‡½æ•°è§£ç  + AI åˆ†æ |
| `signature` | SignatureResult + RagExplanation | ç­¾åè§£æ + AI åˆ†æ |

### 4.3 ä¸»é¢˜è‰²

```css
:root {
  /* ä¸»è‰²è°ƒ - OneKey å“ç‰Œè‰² */
  --primary: #00b894;

  /* é“¾é¢œè‰² */
  --chain-eth: #627eea;
  --chain-bsc: #f3ba2f;
  --chain-polygon: #8247e5;
  --chain-arbitrum: #28a0f0;
  --chain-optimism: #ff0420;

  /* é£é™©é¢œè‰² */
  --risk-low: #00b894;
  --risk-medium: #fdcb6e;
  --risk-high: #e74c3c;
  --risk-critical: #c0392b;
}
```

---

## 5. æµè§ˆå™¨æ‰©å±•æ–¹æ¡ˆ

> å°† TX Analyzer ä»ç‹¬ç«‹ Web åº”ç”¨æ”¹é€ ä¸ºæµè§ˆå™¨æ‰©å±•ï¼Œå®ç°ä¸ OneKey ç­‰é’±åŒ…çš„æ— ç¼é›†æˆ

### 5.1 äº§å“å½¢æ€

#### ä¸‰ç§äº¤äº’åœºæ™¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æµè§ˆå™¨æ‰©å±•äº§å“å½¢æ€                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  åœºæ™¯ 1: Popup ä¸»åŠ¨æŸ¥è¯¢                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  [Extension Icon]    â”‚  ç”¨æˆ·ç‚¹å‡»å›¾æ ‡ â†’ å¼¹å‡ºçª—å£ â†’ è¾“å…¥ä»»æ„å†…å®¹ â†’ æ™ºèƒ½åˆ†æ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                   â”‚
â”‚  â”‚  â”‚ æ”¯æŒè¾“å…¥:      â”‚  â”‚  é€‚ç”¨ï¼šæŸ¥è¯¢å†å²äº¤æ˜“ã€ç ”ç©¶åˆ†æã€é¢„æ£€ç­¾å            â”‚
â”‚  â”‚  â”‚ â€¢ TX Hash      â”‚  â”‚                                                   â”‚
â”‚  â”‚  â”‚ â€¢ Calldata     â”‚  â”‚                                                   â”‚
â”‚  â”‚  â”‚ â€¢ Signature    â”‚  â”‚                                                   â”‚
â”‚  â”‚  â”‚ [Smart Analyze]â”‚  â”‚                                                   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚                                                                              â”‚
â”‚  åœºæ™¯ 2: Content Script äº¤æ˜“æ‹¦æˆª (æ ¸å¿ƒåœºæ™¯)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Uniswap / OpenSea / ä»»æ„ dApp                                â”‚           â”‚
â”‚  â”‚                                                               â”‚           â”‚
â”‚  â”‚  ç”¨æˆ·ç‚¹å‡» [Swap] â†’ æ‰©å±•æ‹¦æˆª eth_sendTransaction               â”‚           â”‚
â”‚  â”‚                           â†“                                   â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚           â”‚
â”‚  â”‚  â”‚  âš ï¸ TX Analyzer å®‰å…¨æ£€æŸ¥                        â”‚         â”‚           â”‚
â”‚  â”‚  â”‚                                                  â”‚         â”‚           â”‚
â”‚  â”‚  â”‚  äº¤æ˜“ç±»å‹: Swap (USDC â†’ ETH)                    â”‚         â”‚           â”‚
â”‚  â”‚  â”‚  é£é™©ç­‰çº§: ğŸŸ¡ Medium                            â”‚         â”‚           â”‚
â”‚  â”‚  â”‚                                                  â”‚         â”‚           â”‚
â”‚  â”‚  â”‚  âš ï¸ æ»‘ç‚¹è®¾ç½®è¾ƒé«˜ (5%)                          â”‚         â”‚           â”‚
â”‚  â”‚  â”‚  âš ï¸ é¦–æ¬¡ä¸è¯¥åˆçº¦äº¤äº’                           â”‚         â”‚           â”‚
â”‚  â”‚  â”‚                                                  â”‚         â”‚           â”‚
â”‚  â”‚  â”‚  [æŸ¥çœ‹è¯¦æƒ…]  [å–æ¶ˆ] [ç»§ç»­ç­¾å]                  â”‚         â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                              â”‚
â”‚  åœºæ™¯ 3: åŒºå—æµè§ˆå™¨å¢å¼º                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Etherscan.io/tx/0x...                                        â”‚           â”‚
â”‚  â”‚                                                               â”‚           â”‚
â”‚  â”‚  Transaction Details          [ğŸ” AI åˆ†æ] â† æ³¨å…¥çš„æŒ‰é’®       â”‚           â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚           â”‚
â”‚  â”‚  Status: Success                                              â”‚           â”‚
â”‚  â”‚  Block: 18234567                                              â”‚           â”‚
â”‚  â”‚                                                               â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åœºæ™¯ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | åœºæ™¯ | ä»·å€¼ | å¤æ‚åº¦ |
|--------|------|------|--------|
| P0 | äº¤æ˜“æ‹¦æˆªé¢„è­¦ | æœ€é«˜ - ç­¾åå‰é˜²æŠ¤ | ä¸­ |
| P1 | Popup ä¸»åŠ¨æŸ¥è¯¢ | é«˜ - ç ”ç©¶åˆ†æ | ä½ |
| P2 | æµè§ˆå™¨å¢å¼º | ä¸­ - é”¦ä¸Šæ·»èŠ± | ä½ |

---

## 6. API è§„èŒƒ

### 6.1 ç«¯ç‚¹åˆ—è¡¨

| Method | Path | è¯´æ˜ |
|--------|------|------|
| GET | `/healthz` | å¥åº·æ£€æŸ¥ |
| GET | `/v1/chains` | è·å–æ”¯æŒçš„é“¾åˆ—è¡¨ |
| POST | `/v1/tx/parse` | çº¯è§£æï¼ˆä¸è°ƒç”¨ RAGï¼‰ |
| POST | `/v1/tx/analyze` | å®Œæ•´åˆ†æï¼ˆå« RAGï¼‰ |
| **POST** | **`/v1/smart-analyze`** | **æ™ºèƒ½åˆ†æï¼ˆæ¨èï¼‰** |
| POST | `/v1/decode` | è§£ç  Calldata |
| POST | `/v1/simulate` | æ¨¡æ‹Ÿäº¤æ˜“æ‰§è¡Œ |
| POST | `/v1/signature/decode` | è§£æç­¾åæ•°æ® |

### 6.2 æ™ºèƒ½åˆ†æè¯·æ±‚ï¼ˆæ¨èï¼‰

```json
POST /v1/smart-analyze

{
  "input": "0x69328dec000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48...",
  "chain_id": 1,
  "context": {
    "to_address": "0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D",
    "from_address": "0x...",
    "value": "0"
  },
  "options": {
    "include_explanation": true,
    "include_trace": false,
    "language": "zh"
  }
}
```

### 6.3 æ™ºèƒ½åˆ†æå“åº”

æ ¹æ® `input_type` è¿”å›ä¸åŒçš„ç»“æœå­—æ®µï¼š

```json
{
  "trace_id": "tx-20250119-abc123",
  "input_type": "calldata",  // "tx_hash" | "calldata" | "signature"
  "status": "success",

  // å½“ input_type == "tx_hash" æ—¶
  "tx_result": { ... },

  // å½“ input_type == "calldata" æ—¶
  "decode_result": {
    "selector": "0x69328dec",
    "function_name": "removeLiquidityETHWithPermit",
    "function_signature": "removeLiquidityETHWithPermit(address,uint256,uint256,uint256,address,uint256,bool,uint8,bytes32,bytes32)",
    "inputs": [...],
    "behavior_type": "liquidity_remove",
    "risk_level": "low",
    "risk_flags": [],
    "warnings": [],
    "contract_type": "uniswap_v2_router"
  },

  // å½“ input_type == "signature" æ—¶
  "signature_result": {
    "signature_type": "permit",
    "primary_type": "Permit",
    "domain": { "name": "USDC", "chainId": 1, ... },
    "message": { "owner": "0x...", "spender": "0x...", "value": "..." },
    "risk_level": "high",
    "risk_reasons": ["æ— é™æˆæƒ"]
  },

  // RAG è§£é‡Šï¼ˆæ‰€æœ‰ç±»å‹éƒ½æ”¯æŒï¼‰
  "explanation": {
    "summary": "è¿™æ˜¯ä¸€ç¬”ä» Uniswap V2 ç§»é™¤æµåŠ¨æ€§çš„äº¤æ˜“...",
    "risk_level": "low",
    "risk_reasons": [],
    "actions": ["ç§»é™¤ USDC-ETH æµåŠ¨æ€§", "ä½¿ç”¨ Permit æˆæƒ"],
    "sources": []
  },

  "timings": {
    "total_ms": 850,
    "fetch_abi_ms": 200,
    "decode_ms": 50,
    "rag_ms": 600
  }
}
```

### 6.4 æ—§ç‰ˆ APIï¼ˆä»ç„¶æ”¯æŒï¼‰

#### äº¤æ˜“åˆ†æ

```json
POST /v1/tx/analyze

{
  "chain_id": 1,
  "tx_hash": "0xabc...def",
  "options": {
    "include_explanation": true,
    "include_trace": false,
    "language": "zh"
  }
}
```

#### Calldata è§£ç 

```json
POST /v1/decode

{
  "calldata": "0xa9059cbb000000000000000000000000...",
  "chain_id": 1,
  "to_address": "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"
}
```

#### ç­¾åè§£æ

```json
POST /v1/signature/decode

{
  "data": {
    "domain": { "name": "USDC", "chainId": 1, ... },
    "message": { "owner": "0x...", "spender": "0x...", ... },
    "primaryType": "Permit",
    "types": { ... }
  },
  "chain_id": 1
}
```

---

## 7. å‡½æ•°ç­¾åæŸ¥è¯¢æœºåˆ¶

### 7.1 ä»€ä¹ˆæ˜¯å‡½æ•°é€‰æ‹©å™¨ (Selector)

åœ¨ EVM ä¸­ï¼Œå½“è°ƒç”¨æ™ºèƒ½åˆçº¦æ–¹æ³•æ—¶ï¼Œcalldata çš„**å‰ 4 å­—èŠ‚**æ˜¯å‡½æ•°çš„ "selector"ï¼š

```
selector = keccak256("å‡½æ•°ç­¾å")[:4]

ä¾‹å¦‚ï¼š
keccak256("transfer(address,uint256)") = 0xa9059cbb1b3fed9d...
å–å‰ 4 å­—èŠ‚ â†’ 0xa9059cbb

æ‰€ä»¥å½“ä½ çœ‹åˆ° calldata = 0xa9059cbb00000000000000...
å‰ 4 å­—èŠ‚ 0xa9059cbb è¡¨ç¤ºè°ƒç”¨çš„æ˜¯ transfer(address,uint256) å‡½æ•°
```

### 7.2 ç­¾åæŸ¥è¯¢çš„ä¸¤çº§æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‡½æ•°ç­¾åæŸ¥è¯¢æµç¨‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  è¾“å…¥: selector = 0xa9059cbb                                         â”‚
â”‚                    â”‚                                                 â”‚
â”‚                    â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚  1. COMMON_SIGNATURES           â”‚ â—„â”€â”€ æœ¬åœ°ç¼“å­˜ï¼ˆ~70ä¸ªå¸¸ç”¨ç­¾åï¼‰   â”‚
â”‚  â”‚     (æœ¬åœ° dictï¼ŒO(1) æŸ¥è¯¢)      â”‚                                â”‚
â”‚  â”‚                                  â”‚     åŒ…å«ï¼š                     â”‚
â”‚  â”‚     signature_db.py ä¸­å®šä¹‰      â”‚     â€¢ ERC-20/721/1155 æ ‡å‡†    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â€¢ Uniswap V2/V3 Router    â”‚
â”‚                   â”‚                       â€¢ WETH deposit/withdraw   â”‚
â”‚         æ‰¾åˆ°ï¼Ÿ â”€â”€â”€â”¼â”€â”€â”€ æ˜¯ â”€â”€â”€â–¶ ç›´æ¥è¿”å›   â€¢ Multicall              â”‚
â”‚                   â”‚             (0ms)     â€¢ å¸¸è§å›è°ƒå‡½æ•°            â”‚
â”‚                   â”‚                                                  â”‚
â”‚                   â”‚ å¦                                               â”‚
â”‚                   â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚  2. 4byte.directory API         â”‚ â—„â”€â”€ å…¬å…±ç­¾åæ•°æ®åº“            â”‚
â”‚  â”‚     https://4byte.directory     â”‚                                â”‚
â”‚  â”‚                                  â”‚     â€¢ 100ä¸‡+ å‡½æ•°ç­¾å         â”‚
â”‚  â”‚     GET /api/v1/signatures/     â”‚     â€¢ ç½‘ç»œè¯·æ±‚ (~100-500ms)   â”‚
â”‚  â”‚     ?hex_signature=0xa9059cbb   â”‚     â€¢ å¯èƒ½è¿”å›å¤šä¸ªåŒ¹é…         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â€¢ å¸¦é‡è¯•æœºåˆ¶              â”‚
â”‚                   â”‚                                                  â”‚
â”‚                   â–¼                                                 â”‚
â”‚         ç¼“å­˜åˆ°å†…å­˜ _local_cache                                      â”‚
â”‚         ä¸‹æ¬¡æŸ¥è¯¢ç›´æ¥è¿”å›                                             â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 COMMON_SIGNATURES è¯¦è§£

ä½äº `services/web3-tx-analyzer/integrations/signature_db.py`ï¼š

```python
# å¸¸ç”¨å‡½æ•°ç­¾åæœ¬åœ°ç¼“å­˜
COMMON_SIGNATURES: dict[str, list[str]] = {
    # ERC-20 æ ‡å‡†
    "0xa9059cbb": ["transfer(address,uint256)"],
    "0x23b872dd": ["transferFrom(address,address,uint256)"],
    "0x095ea7b3": ["approve(address,uint256)"],

    # ERC-721 æ ‡å‡†
    "0x42842e0e": ["safeTransferFrom(address,address,uint256)"],
    "0xa22cb465": ["setApprovalForAll(address,bool)"],

    # Uniswap V2 Router
    "0x38ed1739": ["swapExactTokensForTokens(...)"],
    "0x69328dec": ["removeLiquidityETHWithPermit(...)"],

    # ... çº¦ 70 ä¸ªå¸¸ç”¨ç­¾å
}
```

**ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°ç¼“å­˜ï¼Ÿ**

| åŸå›  | è¯´æ˜ |
|------|------|
| **æ€§èƒ½** | æœ¬åœ°æŸ¥è¯¢ O(1)ï¼Œæ— éœ€ç½‘ç»œè¯·æ±‚ |
| **ç¦»çº¿å¯ç”¨** | å³ä½¿ 4byte.directory ä¸å¯ç”¨ï¼Œå¸¸ç”¨å‡½æ•°ä»èƒ½è¯†åˆ« |
| **å‡†ç¡®æ€§** | åŒä¸€ selector å¯èƒ½å¯¹åº”å¤šä¸ªå‡½æ•°ï¼Œæœ¬åœ°ç¼“å­˜ç¡®ä¿è¿”å›æ­£ç¡®çš„é‚£ä¸ª |
| **ç¨³å®šæ€§** | å‡å°‘å¤–éƒ¨ä¾èµ–ï¼Œæé«˜æœåŠ¡ç¨³å®šæ€§ |

### 7.4 4byte.directory è¯´æ˜

[4byte.directory](https://www.4byte.directory/) æ˜¯ä¸€ä¸ªå…¬å…±çš„å‡½æ•°ç­¾åæ•°æ®åº“ï¼š

- ä»»ä½•äººéƒ½å¯ä»¥æäº¤å‡½æ•°ç­¾å
- ç›®å‰æ”¶å½•äº†è¶…è¿‡ 100 ä¸‡ä¸ªç­¾å
- æä¾› REST API ä¾›æŸ¥è¯¢

**API ç¤ºä¾‹ï¼š**

```bash
curl "https://www.4byte.directory/api/v1/signatures/?hex_signature=0xa9059cbb"

# å“åº”
{
  "count": 1,
  "results": [
    {
      "id": 145,
      "text_signature": "transfer(address,uint256)",
      "hex_signature": "0xa9059cbb"
    }
  ]
}
```

**æ³¨æ„äº‹é¡¹ï¼š**
- åŒä¸€ä¸ª selector å¯èƒ½å¯¹åº”å¤šä¸ªä¸åŒçš„å‡½æ•°ç­¾åï¼ˆå“ˆå¸Œç¢°æ’ï¼‰
- è¿”å›ç»“æœæŒ‰ ID æ’åºï¼Œé€šå¸¸å–ç¬¬ä¸€ä¸ªå³å¯
- æœ‰é€Ÿç‡é™åˆ¶ï¼Œéœ€è¦åˆç†ä½¿ç”¨

### 7.5 äº‹ä»¶ç­¾å

ç±»ä¼¼åœ°ï¼Œäº‹ä»¶ä¹Ÿæœ‰ç­¾åæŸ¥è¯¢æœºåˆ¶ï¼š

```python
# å¸¸ç”¨äº‹ä»¶ç­¾åæœ¬åœ°ç¼“å­˜
COMMON_EVENT_SIGNATURES: dict[str, str] = {
    # ERC-20 Transfer äº‹ä»¶
    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef":
        "Transfer(address,address,uint256)",

    # ERC-20 Approval äº‹ä»¶
    "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925":
        "Approval(address,address,uint256)",

    # Uniswap V2 Swap äº‹ä»¶
    "0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822":
        "Swap(address,uint256,uint256,uint256,uint256,address)",
}
```

äº‹ä»¶ç­¾åä½¿ç”¨å®Œæ•´çš„ 32 å­—èŠ‚ keccak256 å“ˆå¸Œä½œä¸º topic[0]ã€‚

---

## 8. éƒ¨ç½²é…ç½®

### 8.1 Docker Compose

```yaml
# docker-compose.yml
services:
  web3-tx-analyzer:
    build:
      context: ./services/web3-tx-analyzer
      dockerfile: Dockerfile
    profiles: ["tx-analyzer"]
    ports:
      - "127.0.0.1:8001:8001"
    environment:
      - DATABASE_URL=postgresql://...
      - REDIS_URL=redis://tx-analyzer-redis:6379/0
      - RAG_BASE_URL=http://api:8000
    depends_on:
      - postgres
      - tx-analyzer-redis
      - api

  frontend-tx-analyzer:
    image: node:20-alpine
    profiles: ["frontend", "tx-analyzer"]
    ports:
      - "5175:5175"
    volumes:
      - ./frontend-tx-analyzer:/app
    environment:
      NODE_OPTIONS: "--max-old-space-size=4096"
      # å¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨ï¼ˆDocker ç½‘ç»œå†…éƒ¨ï¼‰
      VITE_TX_ANALYZER_API_URL: http://web3-tx-analyzer:8001
      # æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒå‰ç«¯å§‹ç»ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ /tx-analyzer/api
```

### 8.2 Nginx é…ç½®

```nginx
# TX Analyzer å‰ç«¯
location ^~ /tx-analyzer/ {
    proxy_pass http://127.0.0.1:5175;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}

# TX Analyzer API
location ^~ /tx-analyzer/api/ {
    proxy_pass http://127.0.0.1:8001/;
    proxy_buffering off;
}
```

### 8.3 å¯åŠ¨å‘½ä»¤

```bash
# å¯åŠ¨ TX Analyzer æœåŠ¡ï¼ˆå«å‰ç«¯ï¼‰
docker compose --profile tx-analyzer up -d --build

# ä»…å¯åŠ¨åç«¯
docker compose --profile tx-analyzer up -d web3-tx-analyzer tx-analyzer-redis

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f web3-tx-analyzer
docker compose logs -f frontend-tx-analyzer
```

### 8.4 å‰ç«¯ API URL é…ç½®

å‰ç«¯ä½¿ç”¨ä»¥ä¸‹é€»è¾‘ç¡®å®š API åœ°å€ï¼š

```typescript
// WebApp.tsx
// ç”Ÿäº§ç¯å¢ƒå§‹ç»ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆç”± nginx ä»£ç†ï¼‰
// å¼€å‘ç¯å¢ƒå¯ä½¿ç”¨ç¯å¢ƒå˜é‡ç›´æ¥è¿æ¥åç«¯
const API_BASE_URL = import.meta.env.MODE === 'development'
  ? (import.meta.env.VITE_TX_ANALYZER_WEB_API_URL || '/tx-analyzer/api')
  : '/tx-analyzer/api'
```

---

## 9. çŸ¥è¯†åº“å»ºè®¾

> **é‡è¦**ï¼šå½“å‰ RAG æœåŠ¡ä½¿ç”¨çš„æ˜¯ OneKey å¼€å‘è€…æ–‡æ¡£ï¼Œå¯¹äºé€šç”¨çš„åŒºå—é“¾äº¤æ˜“è§£é‡Šæ•ˆæœæœ‰é™ã€‚
> ä¸ºäº†è®© TX Analyzer çš„ RAG è§£é‡Šæ›´æœ‰ä»·å€¼ï¼Œå»ºè®®æ·»åŠ ä»¥ä¸‹åŒºå—é“¾çŸ¥è¯†æ–‡æ¡£ã€‚

### 9.1 DeFi åè®®æ–‡æ¡£ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

#### DEX äº¤æ˜“æ‰€

| åè®® | æ–‡æ¡£åœ°å€ | å†…å®¹ |
|------|----------|------|
| **Uniswap V2** | https://docs.uniswap.org/contracts/v2/overview | Swapã€æµåŠ¨æ€§ã€AMM æœºåˆ¶ |
| **Uniswap V3** | https://docs.uniswap.org/contracts/v3/overview | é›†ä¸­æµåŠ¨æ€§ã€ä»·æ ¼åŒºé—´ |
| **Uniswap V4** | https://docs.uniswap.org/contracts/v4/overview | Hooksã€å•ä¾‹åˆçº¦ |
| **SushiSwap** | https://docs.sushi.com/api/examples/swap | å¤šé“¾ DEXã€Farm |
| **PancakeSwap** | https://docs.pancakeswap.finance/ | BSC DEXã€IFO |
| **Curve** | https://resources.curve.fi/ | ç¨³å®šå¸äº¤æ˜“ã€Gauge |
| **1inch** | https://docs.1inch.io/ | èšåˆå™¨ã€é™ä»·å• |

#### å€Ÿè´·åè®®

| åè®® | æ–‡æ¡£åœ°å€ | å†…å®¹ |
|------|----------|------|
| **Aave V3** | https://docs.aave.com/ | å€Ÿè´·ã€é—ªç”µè´·ã€E-Mode |
| **Compound** | https://docs.compound.finance/ | cTokenã€æ²»ç† |
| **MakerDAO** | https://docs.makerdao.com/ | DAIã€CDPã€æ¸…ç®— |

### 9.2 å®‰å…¨çŸ¥è¯†ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

| èµ„æº | åœ°å€ | å†…å®¹ |
|------|------|------|
| **å¸¸è§æ”»å‡»æ¨¡å¼** | éœ€æ•´ç† | é‡å…¥ã€é—ªç”µè´·æ”»å‡»ã€ä»·æ ¼æ“çºµ |
| **ä»£å¸æˆæƒé£é™©** | éœ€æ•´ç† | Approveã€Permitã€setApprovalForAll |
| **é’“é±¼è¯†åˆ«** | éœ€æ•´ç† | å‡ä»£å¸ã€æ¶æ„åˆçº¦ç‰¹å¾ |
| **Rekt Database** | https://rekt.news/ | å®‰å…¨äº‹ä»¶åˆ†æ |

### 9.3 EVM åŸºç¡€çŸ¥è¯†ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

| ä¸»é¢˜ | å†…å®¹ |
|------|------|
| **ERC-20** | ä»£å¸æ ‡å‡†ã€Transferã€Approveã€TransferFrom |
| **ERC-721** | NFT æ ‡å‡†ã€safeTransferFromã€setApprovalForAll |
| **ERC-1155** | å¤šä»£å¸æ ‡å‡†ã€æ‰¹é‡è½¬è´¦ |
| **ERC-2612** | Permit ç­¾åæˆæƒ |
| **EIP-712** | ç±»å‹åŒ–æ•°æ®ç­¾å |
| **äº¤æ˜“ç±»å‹** | Legacyã€EIP-1559ã€EIP-2930 |
| **Gas æœºåˆ¶** | Gas Limitã€Gas Priceã€Priority Fee |

---

## 10. å®æ–½è¿›åº¦

### 10.1 å·²å®Œæˆ

- [x] åç«¯æœåŠ¡éª¨æ¶
- [x] RPC å®¢æˆ·ç«¯ï¼ˆå¤šé“¾æ”¯æŒï¼‰
- [x] Etherscan å®¢æˆ·ç«¯
- [x] ABI è§£ç å™¨
- [x] äº‹ä»¶åˆ†ç±»å™¨
- [x] è¡Œä¸ºåˆ†æå™¨
- [x] é£é™©æ£€æµ‹å™¨
- [x] RAG å®¢æˆ·ç«¯
- [x] æ—¥å¿—ç³»ç»Ÿï¼ˆJSON + Traceï¼‰
- [x] Redis ç¼“å­˜
- [x] API è·¯ç”±
- [x] Docker éƒ¨ç½²
- [x] å‰ç«¯ UI
- [x] Nginx åå‘ä»£ç†
- [x] **Smart Analyze API**ï¼ˆæ™ºèƒ½åˆ†æï¼‰
- [x] **Calldata è§£ç å™¨**
- [x] **EIP-712 ç­¾åè§£æå™¨**
- [x] **RAG æ”¯æŒæ‰€æœ‰è¾“å…¥ç±»å‹**
- [x] **å‡½æ•°ç­¾åæœ¬åœ°ç¼“å­˜ + 4byte.directory æŸ¥è¯¢**
- [x] **å‰ç«¯æ™ºèƒ½è¾“å…¥ç•Œé¢**

### 10.2 å¾…ä¼˜åŒ–

- [ ] **æµè§ˆå™¨æ‰©å±•å®Œå–„**ï¼ˆè§ç¬¬ 5 èŠ‚ï¼‰
- [ ] çŸ¥è¯†åº“æ–‡æ¡£çˆ¬å–ï¼ˆè§ç¬¬ 9 èŠ‚ï¼‰
- [ ] æ›´å¤šåè®®è¡Œä¸ºè¯†åˆ«
- [ ] æ‰¹é‡åˆ†æ API
- [ ] å†å²è®°å½•æŒä¹…åŒ–
- [ ] äº¤æ˜“æ¨¡æ‹Ÿå®Œå–„
- [ ] æš—è‰²æ¨¡å¼

### 10.3 éªŒæ”¶æ ‡å‡†

| é‡Œç¨‹ç¢‘ | äº¤ä»˜ç‰© | çŠ¶æ€ |
|--------|--------|------|
| M1 | æœåŠ¡éª¨æ¶ | âœ… |
| M2 | åŸºç¡€è§£æ | âœ… |
| M3 | æ—¥å¿—å®Œå–„ | âœ… |
| M4 | RAG é›†æˆ | âœ… |
| M5 | å¤šé“¾æ”¯æŒ | âœ… |
| M6 | Docker éƒ¨ç½² | âœ… |
| M7 | å‰ç«¯ç•Œé¢ | âœ… |
| M8 | **Smart Analyze** | âœ… |
| M9 | çŸ¥è¯†åº“å»ºè®¾ | ğŸ”§ è¿›è¡Œä¸­ |
| M10 | æµè§ˆå™¨æ‰©å±• | ğŸ”§ è¿›è¡Œä¸­ |

---

## é™„å½•

### A. ç¯å¢ƒå˜é‡

```bash
# åç«¯æœåŠ¡
APP_ENV=local
LOG_LEVEL=INFO
DATABASE_URL=postgresql://...
REDIS_URL=redis://...
RAG_BASE_URL=http://api:8000

# é“¾é…ç½®
ETH_RPC_URL=https://eth.llamarpc.com
BSC_RPC_URL=https://bsc-dataseed.binance.org
POLYGON_RPC_URL=https://polygon-rpc.com

# Etherscan API Keys
ETHERSCAN_API_KEY=
BSCSCAN_API_KEY=
POLYGONSCAN_API_KEY=
```

### B. å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
docker compose --profile tx-analyzer up -d --build

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f web3-tx-analyzer

# é‡å¯å‰ç«¯
docker compose --profile tx-analyzer restart frontend-tx-analyzer

# æ¸…ç†é‡å»º
docker compose --profile tx-analyzer down
docker compose --profile tx-analyzer up -d --build

# æµ‹è¯• Smart Analyze API
curl -X POST http://localhost:8001/v1/smart-analyze \
  -H "Content-Type: application/json" \
  -d '{
    "input": "0xa9059cbb000000000000000000000000...",
    "chain_id": 1,
    "options": {"include_explanation": true}
  }'
```

### C. å‚è€ƒèµ„æ–™

- [Etherscan API æ–‡æ¡£](https://docs.etherscan.io/)
- [4byte.directory](https://www.4byte.directory/)
- [EVM Opcodes](https://www.evm.codes/)
- [EIP-712: ç±»å‹åŒ–æ•°æ®ç­¾å](https://eips.ethereum.org/EIPS/eip-712)
- [EIP-2612: Permit ç­¾åæˆæƒ](https://eips.ethereum.org/EIPS/eip-2612)
- [ä»¥å¤ªåŠé»„çš®ä¹¦](https://ethereum.github.io/yellowpaper/paper.pdf)
